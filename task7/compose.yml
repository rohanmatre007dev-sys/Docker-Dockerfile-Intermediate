# Custom network for frontend <-> backend
networks:
  mern-net:

services:
  # -----------------------
  # Backend Service
  # -----------------------
  backend:
    build: ./backend
    container_name: backend
    ports:
      - "4000:4000"
    networks:
      - mern-net

    # Healthcheck: backend is healthy only if HTTP on 4000 responds
    healthcheck:
      # Use Node's HTTP client to hit our own server
      test: ["CMD-SHELL", "node -e \"require('http').get('http://localhost:4000', () => process.exit(0)).on('error', () => process.exit(1));\""]
      interval: 5s       # run every 5 seconds
      timeout: 3s        # give it up to 3 seconds to respond
      retries: 5         # need 5 failures before unhealthy
      start_period: 5s   # grace period while app boots

  # -----------------------
  # Frontend Service
  # -----------------------
  frontend:
    build: ./frontend
    container_name: frontend
    ports:
      - "3000:3000"
    networks:
      - mern-net

    # Wait until backend is marked healthy
    depends_on:
      backend:
        condition: service_healthy

